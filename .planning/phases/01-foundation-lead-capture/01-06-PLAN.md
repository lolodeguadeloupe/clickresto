---
phase: 01-foundation-lead-capture
plan: 06
type: execute
wave: 4
depends_on: ["01-03", "01-05"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Complete flow works: submit form -> lead in database -> lead in admin dashboard"
    - "Auth flow works: signup -> confirm email -> login -> see dashboard"
    - "Magic link flow works: request -> click email link -> logged in"
    - "Mobile landing page is usable and readable"
  artifacts: []
  key_links:
    - from: "Landing page form"
      to: "Supabase leads table"
      via: "supabase.from('leads').insert"
      pattern: "Manual test"
    - from: "Admin dashboard"
      to: "Supabase leads table"
      via: "supabase.from('leads').select"
      pattern: "Manual test"
---

<objective>
End-to-end verification of all Phase 1 functionality.

Purpose: Verify the complete user journey works before marking phase complete. Catch integration issues between components.
Output: Verified working system ready for production use.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-lead-capture/01-01-SUMMARY.md
@.planning/phases/01-foundation-lead-capture/01-02-SUMMARY.md
@.planning/phases/01-foundation-lead-capture/01-03-SUMMARY.md
@.planning/phases/01-foundation-lead-capture/01-04-SUMMARY.md
@.planning/phases/01-foundation-lead-capture/01-05-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure Supabase and run schema</name>
  <files></files>
  <action>
    If not already done, configure Supabase:

    1. Ensure user has a Supabase project created
    2. Update `js/supabase-config.js` with real SUPABASE_URL and SUPABASE_ANON_KEY
    3. Update `backoffice/.env.local` with:
       - NEXT_PUBLIC_SUPABASE_URL
       - NEXT_PUBLIC_SUPABASE_ANON_KEY
       - NEXT_PUBLIC_SITE_URL=http://localhost:3000
    4. Run `supabase/schema.sql` in Supabase SQL Editor
    5. Create an admin user:
       - Sign up via the back-office
       - Then run in SQL Editor:
         ```sql
         UPDATE public.user_roles
         SET role = 'admin'
         WHERE user_id = (
           SELECT id FROM auth.users
           WHERE email = 'YOUR_ADMIN_EMAIL'
         );
         ```

    Verify database setup:
    ```sql
    SELECT * FROM public.user_roles;
    SELECT * FROM public.leads;
    ```
  </action>
  <verify>
    - Tables exist in Supabase
    - At least one user with admin role
    - Environment variables configured
  </verify>
  <done>
    - Supabase project configured
    - Schema deployed
    - Admin user created
    - Environment variables set
  </done>
</task>

<task type="auto">
  <name>Task 2: Start development servers</name>
  <files></files>
  <action>
    Start the Next.js development server:

    ```bash
    cd backoffice && npm run dev
    ```

    Open the landing page by serving index.html:
    - Use VS Code Live Server extension, or
    - `python -m http.server 8080` in project root, or
    - `npx http-server -p 8080`

    Have both running:
    - Landing page: http://localhost:8080
    - Back-office: http://localhost:3000
  </action>
  <verify>
    Both servers running without errors
  </verify>
  <done>
    - Landing page accessible
    - Back-office accessible
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 1 functionality:
    1. Landing page with Supabase form integration
    2. Testimonials section and Calendly placeholder
    3. Mobile responsive design
    4. Back-office authentication (signup, login, magic link, password reset)
    5. Admin leads dashboard with stats and table
  </what-built>
  <how-to-verify>
    **Test 1: Landing Page Lead Submission**
    1. Open landing page at http://localhost:8080
    2. Scroll to contact form
    3. Fill in all fields:
       - Prenom: Test
       - Nom: User
       - Email: test@example.com
       - Telephone: 0612345678
       - Restaurant: Le Test
       - Type: Demande de demo
       - Message: Test message
    4. Click "Envoyer ma demande"
    5. Expected: Success message appears
    6. Check Supabase Table Editor -> leads table should show new row

    **Test 2: Mobile Responsiveness**
    1. Open browser DevTools (F12)
    2. Enable device toolbar (mobile view)
    3. Set to iPhone 12 or similar (390px width)
    4. Scroll through entire landing page
    5. Expected: All sections readable, no horizontal scroll
    6. Test mobile menu: tap hamburger, links should show

    **Test 3: Testimonials and Calendar**
    1. On landing page, scroll to "Temoignages" section
    2. Expected: 3 testimonial cards visible
    3. Expected: Social proof stats (150+, 50k+, 4.8/5)
    4. Scroll to contact section
    5. Expected: Calendly widget placeholder (may show error if not configured)

    **Test 4: Admin Authentication**
    1. Open back-office at http://localhost:3000
    2. Click login or navigate to /login
    3. Enter admin email and password
    4. Click "Se connecter"
    5. Expected: Redirected to /dashboard
    6. Expected: Sidebar shows "Leads" link (admin only)

    **Test 5: Admin Leads Dashboard**
    1. Click "Leads" in sidebar or go to /admin/leads
    2. Expected: Stats cards show (Total leads, Nouveaux, Taux conversion)
    3. Expected: Table shows the test lead from Test 1
    4. Expected: Lead shows status "Nouveau" (blue badge)

    **Test 6: Magic Link (optional)**
    1. Log out via header
    2. On login page, switch to "Lien magique" tab
    3. Enter your email
    4. Click "Envoyer le lien"
    5. Check email for magic link
    6. Click link in email
    7. Expected: Redirected to /dashboard logged in

    **Test 7: Non-Admin Access Control**
    1. Create new user via /signup (or use existing affiliate)
    2. Log in as this non-admin user
    3. Try to access /admin/leads directly
    4. Expected: Redirected to /dashboard
    5. Expected: Sidebar does NOT show "Leads" link
  </how-to-verify>
  <resume-signal>
    Type "approved" if all tests pass.
    If issues found, describe them and I will fix before continuing.
  </resume-signal>
</task>

</tasks>

<verification>
All tests in the checkpoint pass:
- Lead submission stores data in Supabase
- Landing page mobile responsive
- Testimonials and calendar sections present
- Auth flows work (signup, login, magic link)
- Admin dashboard shows leads
- Role-based access control works
</verification>

<success_criteria>
Phase 1 is complete when:
1. Restaurant owner can submit demo request from landing page
2. Lead data captured in Supabase database
3. Admin can log in and view leads in dashboard
4. Non-admin cannot access admin pages
5. Magic link authentication works
6. Landing page fully responsive on mobile
7. Testimonials section visible
8. Calendar booking placeholder in place
</success_criteria>

<output>
After completion and approval, create `.planning/phases/01-foundation-lead-capture/01-06-SUMMARY.md` documenting:
- All tests passed
- Any issues found and fixed
- Configuration notes for deployment
</output>
