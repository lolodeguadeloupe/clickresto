---
phase: 02-contact-form
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [index.html]
autonomous: true

must_haves:
  truths:
    - "Contact section is visible with working #contact anchor"
    - "Form displays all required fields (nom, email, telephone, etablissement, type, message)"
    - "Toggle buttons switch between Restaurateur and Apporteur d'affaires"
    - "Validation prevents incomplete form submission"
    - "Error messages appear under invalid fields with red border"
    - "Success message replaces form after mock submission"
  artifacts:
    - path: "index.html"
      provides: "Contact section HTML and form validation JavaScript"
      contains: ["id=\"contact\"", "class=\"contact-form\"", "validateForm", "showSuccess"]
  key_links:
    - from: "form submit event"
      to: "validateForm function"
      via: "addEventListener('submit')"
      pattern: "addEventListener.*submit"
    - from: "toggle buttons"
      to: "hidden input value"
      via: "click event updates hidden input"
      pattern: "input\\[name=\"type\"\\]"
    - from: "type selector"
      to: "etablissement required state"
      via: "conditional required attribute"
      pattern: "required.*etablissement|etablissement.*required"
---

<objective>
Add the complete contact form section with client-side validation to index.html.

Purpose: Enable visitors (restaurateurs and affilies) to submit contact requests through a validated form.
Output: Functional contact section with form validation, toggle type selector, and success/error states.
</objective>

<execution_context>
@/home/laurent/.claude/get-shit-done/workflows/execute-plan.md
@/home/laurent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-contact-form/02-CONTEXT.md
@.planning/phases/02-contact-form/02-RESEARCH.md
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add contact section HTML</name>
  <files>index.html</files>
  <action>
Add a contact section between the affiliation section and footer in index.html.

Structure (use existing CSS classes from template):
```html
<section class="contact" id="contact">
  <div class="container">
    <div class="contact-container">
      <div class="contact-info">
        <h2>...</h2>
        <p>...</p>
        <!-- Optional: contact methods -->
      </div>
      <div class="contact-form">
        <form id="contactForm" novalidate>
          <!-- Type selector FIRST -->
          <fieldset class="form-group type-selector">
            <legend>Je suis</legend>
            <div class="toggle-group" role="radiogroup">
              <button type="button" role="radio" aria-checked="true" class="toggle-btn active" data-value="restaurateur">Restaurateur</button>
              <button type="button" role="radio" aria-checked="false" class="toggle-btn" data-value="apporteur">Apporteur d'affaires</button>
            </div>
            <input type="hidden" name="type" value="restaurateur">
          </fieldset>

          <!-- Form fields -->
          <div class="form-row">
            <div class="form-group">
              <label for="nom">Nom <span class="required">*</span></label>
              <input type="text" id="nom" name="nom" required aria-describedby="nom-error">
              <span id="nom-error" class="error-message" aria-live="polite"></span>
            </div>
            <div class="form-group">
              <label for="email">Email <span class="required">*</span></label>
              <input type="email" id="email" name="email" required aria-describedby="email-error">
              <span id="email-error" class="error-message" aria-live="polite"></span>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="telephone">Telephone <span class="required">*</span></label>
              <input type="tel" id="telephone" name="telephone" required pattern="^0[1-9](?:[ ]?[0-9]{2}){4}$" placeholder="06 12 34 56 78" aria-describedby="telephone-error">
              <span id="telephone-error" class="error-message" aria-live="polite"></span>
            </div>
            <div class="form-group">
              <label for="etablissement">Etablissement <span class="required-restaurateur">*</span></label>
              <input type="text" id="etablissement" name="etablissement" required aria-describedby="etablissement-error">
              <span id="etablissement-error" class="error-message" aria-live="polite"></span>
            </div>
          </div>

          <div class="form-group">
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="5" placeholder="Dites-nous en plus sur votre projet..."></textarea>
          </div>

          <button type="submit" class="btn btn-primary">Envoyer</button>
        </form>
        <div class="form-success">
          <p>Merci ! Nous vous recontacterons rapidement.</p>
        </div>
      </div>
    </div>
  </div>
</section>
```

CSS additions to add in style section:
- `.type-selector` - fieldset styling with no border
- `.toggle-group` - flex container for toggle buttons
- `.toggle-btn` - styled buttons matching Pop & Colore theme
- `.toggle-btn.active` - active state with primary color
- `.error-message` - red error text below fields
- `.form-group.error input/textarea` - red border for invalid fields
- `.required, .required-restaurateur` - red asterisk styling
- `.form-loading` - overlay state during submission (for Phase 3)

Tone: "Pop & Colore" - playful, use tutoiement
- Title example: "On discute?" or "Envie de se lancer?"
- Subtitle example: "Laisse-nous tes coordonnees et on te rappelle vite fait!"

Important:
- Add `novalidate` to form element (we handle validation in JS)
- Use aria-describedby to connect inputs to error spans
- Placeholder for message adapts based on type (handled in JS)
  </action>
  <verify>
Open index.html in browser, verify:
1. Contact section appears with #contact anchor working
2. Form displays with all fields visible
3. Toggle buttons are styled and clickable
4. Two-column layout on desktop, single column on mobile
  </verify>
  <done>
Contact section HTML complete with all form fields, toggle type selector, and proper accessibility attributes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add form validation JavaScript</name>
  <files>index.html</files>
  <action>
Add JavaScript in the script section at the bottom of index.html (replace the placeholder comment).

Functionality to implement:

1. Toggle button handler:
```javascript
const toggleBtns = document.querySelectorAll('.toggle-btn');
const typeInput = document.querySelector('input[name="type"]');
const etablissementInput = document.getElementById('etablissement');
const etablissementRequired = document.querySelector('.required-restaurateur');
const messageTextarea = document.getElementById('message');

toggleBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    toggleBtns.forEach(b => {
      b.classList.remove('active');
      b.setAttribute('aria-checked', 'false');
    });
    btn.classList.add('active');
    btn.setAttribute('aria-checked', 'true');
    typeInput.value = btn.dataset.value;

    // Update etablissement required state
    const isRestaurateur = btn.dataset.value === 'restaurateur';
    etablissementInput.required = isRestaurateur;
    etablissementRequired.style.display = isRestaurateur ? 'inline' : 'none';

    // Update message placeholder
    messageTextarea.placeholder = isRestaurateur
      ? 'Parle-nous de ton resto et de tes besoins...'
      : 'Dis-nous comment tu comptes nous aider a trouver des restos!';
  });
});
```

2. Form validation on submit:
```javascript
const form = document.getElementById('contactForm');
const formSuccess = document.querySelector('.form-success');

form.addEventListener('submit', (e) => {
  e.preventDefault();

  // Clear previous errors
  document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
  document.querySelectorAll('.form-group').forEach(el => el.classList.remove('error'));

  let isValid = true;
  let firstError = null;

  // Validate nom
  const nom = document.getElementById('nom');
  if (!nom.value.trim()) {
    showError(nom, 'Le nom est requis');
    isValid = false;
    firstError = firstError || nom;
  }

  // Validate email
  const email = document.getElementById('email');
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!email.value.trim()) {
    showError(email, 'L\'email est requis');
    isValid = false;
    firstError = firstError || email;
  } else if (!emailRegex.test(email.value)) {
    showError(email, 'Format d\'email invalide');
    isValid = false;
    firstError = firstError || email;
  }

  // Validate telephone (French format: 10 digits starting with 0)
  const telephone = document.getElementById('telephone');
  const phoneRegex = /^0[1-9](?:[ ]?[0-9]{2}){4}$/;
  if (!telephone.value.trim()) {
    showError(telephone, 'Le telephone est requis');
    isValid = false;
    firstError = firstError || telephone;
  } else if (!phoneRegex.test(telephone.value.replace(/\s/g, ' ').trim())) {
    showError(telephone, 'Format: 06 12 34 56 78');
    isValid = false;
    firstError = firstError || telephone;
  }

  // Validate etablissement (only if restaurateur)
  const etablissement = document.getElementById('etablissement');
  if (typeInput.value === 'restaurateur' && !etablissement.value.trim()) {
    showError(etablissement, 'Le nom de l\'etablissement est requis');
    isValid = false;
    firstError = firstError || etablissement;
  }

  if (!isValid) {
    firstError.focus();
    return;
  }

  // Mock success (Phase 3 will add Firebase)
  form.style.display = 'none';
  formSuccess.classList.add('show');
});

function showError(input, message) {
  const errorEl = document.getElementById(input.id + '-error');
  errorEl.textContent = message;
  input.closest('.form-group').classList.add('error');
}
```

3. Clear error on blur after correction:
```javascript
['nom', 'email', 'telephone', 'etablissement'].forEach(fieldId => {
  const field = document.getElementById(fieldId);
  field.addEventListener('blur', () => {
    const group = field.closest('.form-group');
    if (group.classList.contains('error') && field.value.trim()) {
      group.classList.remove('error');
      document.getElementById(fieldId + '-error').textContent = '';
    }
  });
});
```

Error state CSS (add to style section if not already present):
```css
.error-message {
  color: var(--primary);
  font-size: 0.875rem;
  margin-top: 0.25rem;
  display: block;
}
.form-group.error input,
.form-group.error textarea {
  border-color: var(--primary);
}
.required, .required-restaurateur {
  color: var(--primary);
}
```
  </action>
  <verify>
Test in browser:
1. Click toggle buttons - verify type switches and placeholder updates
2. Submit empty form - verify error messages appear under each required field
3. Submit with invalid email - verify email error message
4. Submit with invalid phone - verify phone error message
5. Select "Apporteur" - verify etablissement is no longer required
6. Fix an error and blur - verify error clears
7. Submit valid form - verify success message replaces form
  </verify>
  <done>
Form validation complete: toggle buttons work, validation on submit, error display with red borders, blur clears errors, success message shows on valid submission.
  </done>
</task>

</tasks>

<verification>
Overall verification:
1. Contact section visible at #contact anchor
2. All form fields present (nom, email, telephone, etablissement, type, message)
3. Toggle buttons switch between Restaurateur/Apporteur
4. Validation prevents incomplete submissions
5. Error messages under invalid fields with red border
6. Success message shows after valid submission

Requirements coverage:
- CTT-01: Section contact visible avec ancre #contact - YES
- CTT-02: Formulaire avec champs nom, email, telephone, etablissement - YES
- CTT-03: Selecteur type Restaurateur/Apporteur - YES
- CTT-04: Champ message/commentaire - YES
- CTT-05: Validation cote client - YES
- CTT-06: Message de succes - YES (mock, Firebase in Phase 3)
</verification>

<success_criteria>
- [ ] Contact section exists with id="contact"
- [ ] Form contains: nom, email, telephone, etablissement, type selector, message
- [ ] Toggle buttons switch type and update hidden input
- [ ] Etablissement required only when Restaurateur selected
- [ ] Message placeholder changes based on type
- [ ] Empty required fields show error on submit
- [ ] Invalid email format shows error
- [ ] Invalid phone format shows error
- [ ] First error field receives focus on submit
- [ ] Errors clear on blur after correction
- [ ] Valid form shows success message
</success_criteria>

<output>
After completion, create `.planning/phases/02-contact-form/02-01-SUMMARY.md`
</output>
