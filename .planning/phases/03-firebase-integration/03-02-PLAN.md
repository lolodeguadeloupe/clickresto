---
phase: 03-firebase-integration
plan: 02
type: execute
wave: 2
depends_on: [03-01]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Form submission stores data in Supabase contacts table"
    - "Loading state visible during submission"
    - "Success message displays after submission with re-submit option"
    - "Error handling works for failures"
  artifacts: []
  key_links: []
---

<objective>
Verify the complete Supabase integration works end-to-end: SQL migration applied, form submission stores data, all UI states (loading, success, error) function correctly.

Purpose: Confirm Phase 3 is complete — the lead capture pipeline works for real.
Output: Verified working form submission or list of issues to fix.
</objective>

<execution_context>
@/home/laurent/.claude/get-shit-done/workflows/execute-plan.md
@/home/laurent/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/03-firebase-integration/03-01-SUMMARY.md
@index.html
</context>

<tasks>

<task type="checkpoint:human-action" gate="blocking">
  <name>Task 1: Run SQL migration on Supabase</name>
  <action>
Run the SQL migration script on Supabase.

1. Open Supabase SQL Editor (your self-hosted instance dashboard)
2. Copy the contents of `migrations/001_contacts.sql`
3. Execute the SQL
4. Verify the `contacts` table was created with all columns and constraints
  </action>
  <resume-signal>Type "done" once the migration has been applied, or describe any errors.</resume-signal>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Supabase form integration with loading, success, error states, honeypot anti-spam, timeout handling, and offline detection.</what-built>
  <how-to-verify>
1. Open `index.html` in your browser (or via local server)
2. Fill the form with valid data (Restaurateur type, all required fields)
3. Click "Envoyer" — verify:
   a. Button shows loading spinner
   b. After ~1-2 seconds, form disappears
   c. Success message shows "Merci ! Nous vous recontacterons sous 48h."
   d. "Envoyer un autre message" button is visible
4. Click "Envoyer un autre message" — verify form reappears empty
5. Switch to Apporteur type, fill minimal fields, submit — verify it works
6. Check your Supabase dashboard: both submissions should appear in the `contacts` table with status "nouveau"
7. Test error: temporarily disconnect internet, try to submit — verify offline warning appears
8. Test validation: submit empty form — verify Phase 2 validation still works (error messages, focus on first error)
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe which tests failed.</resume-signal>
</task>

</tasks>

<verification>
All Phase 3 success criteria met:
1. Supabase contacts table exists with correct schema
2. Form submissions save to contacts table
3. Anon key can only INSERT (no reads)
4. Loading state shows during submission
5. Success message appears after successful submission
6. Error state handled for failures
</verification>

<success_criteria>
- User confirms form submission stores data in Supabase
- User confirms loading, success, and error states work
- User confirms all Phase 2 validation preserved
</success_criteria>

<output>
After completion, create `.planning/phases/03-firebase-integration/03-02-SUMMARY.md`
</output>
